{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}{{ block.super }}
<script src="{% url 'admin:jsi18n' %}"></script>
{{ media }}
{% endblock %}

{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}">{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} change-form{% endblock %}

{% block content %}<div id="content-main">
{% block object-tools %}
{% if change %}{% if not is_popup %}
  <ul class="object-tools">
    {% block object-tools-items %}
      {% change_form_object_tools %}
    {% endblock %}
  </ul>
{% endif %}{% endif %}
{% endblock %}
<form {% if has_file_field %}enctype="multipart/form-data" {% endif %}{% if form_url %}action="{{ form_url }}" {% endif %}method="post" novalidate>{% csrf_token %}{% block form_top %}{% endblock %}
<div>
{% if errors %}
    <p class="errornote">
    {% if errors|length == 1 %}{% translate "Please correct the error below." %}{% else %}{% translate "Please correct the errors below." %}{% endif %}
    </p>
    {{ adminform.form.non_field_errors }}
{% endif %}


    <div id="content" class="colM">

        <h1>Sending TC to user {{ user.username }} ({{ user.email }})</h1>
        <div id="content-main">


            <div>


                <fieldset class="module aligned ">
                    <div class="form-row">
                        <div>
                            <label for="id_user">Amount:</label>
                            <input type="number" name="amount" value="0" class="vTextField"
                                   maxlength="64" id="amount">
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="id_user">Reason:</label>
                            <input type="text" name="reason" value="Daily contest" class="vTextField"
                                   maxlength="128" id="reason">
                        </div>
                    </div>
                </fieldset>
                <div class="submit-row">

                    <input type="button" value="Save" onclick="send_tc_crystalls()" class="default" name="_save">

{#                    <p class="deletelink-box"><a href="/admin/db/account/3376/delete/" class="deletelink">Delete</a></p>#}


{#                    <input type="button" value="Save and continue editing" name="_continue">#}


                </div>
            </div>
        </div>
        <br class="clear">
    </div>

    <script>
        function send_tc_crystalls() {
            ws.send(JSON.stringify(
                {
                    action: 'send_tc',
                    amount: parseFloat(document.getElementById('amount').value),
                    reason: document.getElementById('reason').value,
                    user_id: "{{ user.id }}",
                }
            ));
        }
        var ws = new WebSocket("wss://pay2k.com/api/admin-websocket/");
        ws.onopen = function () {

        };
        ws.onmessage = function (evt) {
            alert(evt.data);
        };
    </script>
</div>
</form></div>
{% endblock %}
